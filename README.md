# 피드백에 따른 개선 사항

1. 비동기 처리 위치 문제
   - 해결: 비동기 메소드 호출을 값이 validate할때만 일어나도록 if문 안으로 이동시켰습니다.
   - **질문 사항**: 수정 전에도 validate하지 않으면 else문에서 값을 리턴하고 메소드를 종료하기 때문에 비동기 메소드 호출이 일어나지 않는 것 같은데 혹시 제가 놓친 부분이 있는 것인지 궁금합니다.
2. 키워드 매칭 비효율 문제
   - 게시물의 글자수가 N, DB에 저장된 키워드의 개수가 M개라고 할때, 기존의 코드에서 알림이 필요한 키워드를 뽑는 시간 복잡도는 O(NM)입니다.
   - 개선한 코드의 아이디어를 개괄적으로 설명하면, 입력으로 들어온 게시물로부터 만들수 있는 길이 1부터 20까지(키워드의 글자수가 최대 20이라고 가정)의 부분 문자열을 모두 생성하면 등차수열의 합공식에 따라 대략 ((N+(N-19))+20)/2 => O(N)의 시간복잡도를 갖습니다. 각각의 부분 문자열이 DB에 존재하는 키워드 인지를 판단하기 위해 O(logM)시간복잡도가 요구됩니다. 키워드 필드로 인덱스를 생성하여야 logM이 될 수 있습니다. 따라서 최종적으로 O(NlogM)의 시간복잡도를 갖도록 개선할 수 있었습니다.
   - N의 경우 최대 1100의 값을 갖게 되므로 큰 값을 갖을 수 있는 M으로 인해 발생하는 시간복잡도를 줄여 성능을 개선할 수 있었습니다.
   - 추가로 뽑아낸 키워드마다 키워드 알림을 보내야하는 사용자를 선정하는 부분을 비동기 함수로 병렬 처리하여 속도를 개선하고자 했습니다.
   - **질문사항**: 현재는 키워드 Select을 따로하고 다시 뽑아낸 키워드로 user selection을 진행하는데 이것을 조인테이블을 생성해서 하는 것이 더 나은 방법인지 궁금합니다.
3. Ruby lint
   - 알려주신 standard gem을 사용하여 ruby스러운 코드로 변환했습니다.

# 실행 환경

- ruby 3.0.2
- rails Rails 6.1.4.1
- sidekiq
- redis

키워드 알림의 비동기 실행을 위하여 sidekiq 라이브러리를 사용했습니다. sidekiq 사용을 위하여 redis가 필요합니다.

# 실행 방법

도커 컴포즈를 이용하여 자동으로 환경을 구축하여 실행하도록 했습니다.

```
docker-compose up
```

# 테스트 결과

1. 게시글 등록
   ![Post posts request](./img/PostPosts.png)
   ![Post posts request](./img/PostPosts2.png)

2. 키워드 등록
   ![Post keywords request](./img/PostKeywords.png)
   ![Post keywords request](./img/PostKeyword2.png)

3. 키워드 삭제
   ![Delete keywords request](./img/DeleteKeywords.png)
   ![Delete keywords request](./img/DeleteKeywords2.png)

4. 자동 알림 발송 기능
   ![Post posts request](./img/PostPosts.png)
   ![result](./img/select.png)

# 보완이 필요한 부분들

- 데이터 베이스를 sqlite3를 사용 → mysql을 사용하려고 했으나 설치가 안됨 오류 해결 못함
- 고정값의 authentication을 구현하지 못함(로그인 상태일때만 모든 기능이 작동하도록하여야 하지만 현재는 로그인 없이 게시물이나 키워드를 저장할때 user_id필드에 데이터 베이스에 존재하는 첫번째 user의 정보가 저장되도록 하였습니다.)
- keyword 모델의 count 변수 사용: 처음에는 특정 키워드에 대한 알림을 필요로 하는 사람의 수를 keyword모델의 count 변수에 숫자로 표현했습니다. 하지만 이렇게 하는 것 보다 model의 has_many 관계의 dependent 옵션을 사용하여 관리하는 것이 더 좋은 방법으로 생각됩니다.
- 응답 메세지를 어떠한 형식으로 보내주어야 하는지 잘 모르겠습니다. 현재는 성공한 경우 저장된 데이터를 응답하고 에러 발생시 에러 메세지를 응답으로 보내주도록 하였습니다.
- 테스트를 체계적으로 진행하지 못했습니다. 테스트를 자동화 할 수 있는 툴을 사용해야 할것으로 판단됩니다.
- db파일이 container안에서 생성되어 이를 확인하기 어렵습니다. Docker volume을 사용하면 호스트에 저장할 수 있다고 합니다. 이 부분에 보완이 필요합니다.
- 알림을 보내야할 사용자를 뽑아내는 것을 구현했지만 이를 어떻게 보여드려야 하는지 잘 모르겠습니다. 현재는 단순히 console창에 출력하도록 했습니다. 그러나 도커에서 작동할때는 출력이 안됩니다.
- 현재는 키워드에 대한 구분이 없이 알림 대상자를 선정합니다. 실제 알림을 보내려면 어떤 키워드에 대한 알림인지도 구분하여야 합니다.
